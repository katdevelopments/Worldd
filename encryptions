// Roblox Version: version-eaebe135b3ec446b (LIVE)
// Byfron Version(s): [hyperion-secured] [yara-secured]
// Encryptions and Structs

#define PROTO_LINEINFO_ENC VMValue1
#define PROTO_DEBUGINSN_ENC VMValue1
#define PROTO_DEBUGNAME_ENC VMValue4
#define PROTO_TYPEINFO_ENC VMValue1

#pragma once

#define CommonHeader \
    uint8_t memcat; \ // -1
    uint8_t tt; \ // 0
    uint8_t marked;  // 0

typedef struct stringtable 
{
    int size; // 56
    uint32_t nuse; // 60
    TString** hash; // 64
} stringtable;

typedef struct CallInfo
{
    StkId base; // 0
    const Instruction* savedpc; // 8
    StkId func; // 16
    StkId top; // 24
    int nresults; // 32
    unsigned int flags; // 36
} CallInfo;

typedef struct TString
{
    int16_t atom; // 4
    TString* next; // 8
    tstring_hash<unsigned int> hash; // 16
    tstring_len<unsigned int> len; // 20
    char data[1]; // 24
} TString;

typedef struct Table
{
    CommonHeader ; // 0
    uint8_t tmcache; // 3
    uint8_t safeenv; // 4
    uint8_t lsizenode; // 5
    uint8_t nodemask8; // 6
    uint8_t readonly; // 7
    int sizearray; // 8
    union
    {
        int aboundary;
        int lastfree; // 12
    };
    table_node<LuaNode*> node; // 16
    GCObject* gclist; // 24
    table_metatable<struct Table*> metatable; // 32
    table_array<TValue*> array; // 40
} Table;

struct lua_State
{
    luastate_global<global_State*> global; // -1
    Table* gt; // -1
    StkId stack; // -1
    luastate_stacksize<int> stacksize; // -1
    RBXExtraSpace* userdata; // -1
    uint8_t activememcat; // -1
    UpVal* openupval; // -1
    TString* namecall; // -1
    uint8_t status; // -1
    int cachedslot; // -1
    CommonHeader ; // 0
    bool singlestep; // 5
    bool isactive; // 6
    GCObject* gclist; // 24
    StkId top; // 40
    StkId base; // 56
    CallInfo* ci; // 64
    StkId stack_last; // 80
    int size_ci; // 92
    CallInfo* end_ci; // 104
    CallInfo* base_ci; // 112
    unsigned short nCcalls; // 120
    unsigned short baseCcalls; // 122
};

typedef struct Closure
{
    CommonHeader ; // 0
    uint8_t isC; // 3
    uint8_t preload; // 4
    uint8_t nupvalues; // 5
    uint8_t stacksize; // 6
    GCObject* gclist; // 8
    struct Table* env; // 16

    union
    {
        struct
        {
            closure_c_f<lua_CFunction> f; // 24
            closure_c_debugname<const char*> debugname; // 32
            closure_c_cont<lua_Continuation> cont; // 40
            TValue upvals[1]; // 48
        } c;

        struct
        {
            closure_l_p<struct Proto*> p; // 24
            TValue uprefs[1]; // 44
        } l;
    };
} Closure;

typedef struct Proto 
{
    uint8_t nups; // -1
    uint8_t numparams; // -1
    uint8_t is_vararg; // -1
    uint8_t maxstacksize; // -1
    uint8_t flags; // -1
    TValue* k; // -1
    Instruction* code; // -1
    struct Proto** p; // -1
    const Instruction* codeentry; // -1
    void* execdata; // -1
    uintptr_t exectarget; // -1
    proto_lineinfo<uint8_t*> lineinfo; // -1
    proto_abslineinfo<int*> abslineinfo; // -1
    proto_locvars<struct LocVar*> locvars; // -1
    proto_upvalues<TString**> upvalues; // -1
    proto_source<TString*> source; // -1
    proto_debugname<TString*> debugname; // -1
    proto_debuginsn<uint8_t*> debuginsn; // -1
    proto_typeinfo<uint8_t*> typeinfo; // -1
    proto_userdata<void*> userdata; // -1
    GCObject* gclist; // -1
    int sizecode; // -1
    int sizep; // -1
    int sizelocvars; // -1
    int sizeupvalues; // -1
    int sizek; // -1
    int sizelineinfo; // -1
    int linegaplog2; // -1
    int linedefined; // -1
    int bytecodeid; // -1
    int sizetypeinfo; // -1
    CommonHeader ; // 0
} Proto;
