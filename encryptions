// Roblox Version: version-5b077c09380f4fe6 (OUTDATED)
// Byfron Version(s): Hyperion 5.2

// Encryptions (by enzo)

#define LSTATE_GLOBAL_ENC VMVALUE0
#define CLOSURE_FUNC_ENC VMVALUE0
#define TABLE_MEMBER_ENC VMVALUE0
#define TABLE_META_ENC VMVALUE0
#define TSTRING_LEN_ENC VMVALUE0
#define GSTATE_TTNAME_ENC VMVALUE0
#define GSTATE_TMNAME_ENC VMVALUE0
#define PROTO_DEBUGINSN_ENC VMVALUE1
#define CLOSURE_DEBUGNAME_ENC VMVALUE4
#define PROTO_TYPEINFO_ENC VMVALUE1
#define PROTO_ABSLINEINFO_ENC VMVALUE3
#define PROTO_DEBUGNAME_ENC VMVALUE4
#define PROTO_MEMBER1_ENC VMVALUE0
#define PROTO_USERDATA_ENC VMVALUE3
#define PROTO_UPVALUES_ENC VMVALUE1
#define PROTO_LOCVARS_ENC VMVALUE3
#define PROTO_SOURCE_ENC VMVALUE2
#define PROTO_LINEINFO_ENC VMVALUE1 
#define CLOSURE_CONT_ENC VMVALUE2
#define LSTATE_STACKSIZE_ENC VMVALUE3
#define TSTRING_HASH_ENC VMVALUE4
#define UDATA_META_ENC VMVALUE2

// Auto generated structs (by igromanvtv)

#pragma once

#define CommonHeader \
    uint8_t marked; \ // 0
    uint8_t tt; \ // 1
    uint8_t memcat;  // 2

typedef struct stringtable 
{
    int size; // 56
    uint32_t nuse; // 60
    TString** hash; // 64
} stringtable;
	
typedef struct CallInfo
{
    StkId base; // 0
    const Instruction* savedpc; // 8
    StkId func; // 16
    StkId top; // 24
    int nresults; // 32
    unsigned int flags; // 36
} CallInfo;

typedef struct TString
{
    int16_t atom; // 4
    TString* next; // 8
    tstring_hash<unsigned int> hash; // 16
    tstring_len<unsigned int> len; // 20
    char data[1]; // 24
} TString;

typedef struct Table
{
    CommonHeader ; // 0
    uint8_t tmcache; // 3
    uint8_t safeenv; // 4
    uint8_t lsizenode; // 5
    uint8_t nodemask8; // 6
    uint8_t readonly; // 7
    int sizearray; // 8
    union
    {
        int aboundary;
        int lastfree; // 12
    };
    table_node<LuaNode*> node; // 16
    GCObject* gclist; // 24
    table_metatable<struct Table*> metatable; // 32
    table_array<TValue*> array; // 40
} Table;

struct lua_State {
    CommonHeader;

    uint8_t status;

    uint8_t activememcat;

    bool singlestep;
    bool isactive;

    RobloxExtraSpace* userdata;

    TString* namecall;

    GCObject* gclist;
    LuaTable* gt;

    StkId top;
    StkId stack;
    StkId base;
    CallInfo* ci;
    global_State* global;
    StkId stack_last;

    LSTATE_STACKSIZE_ENC< int > stacksize;
    int size_ci;

    UpVal* openupval;

    CallInfo* end_ci;
    CallInfo* base_ci;

    unsigned short nCcalls;
    unsigned short baseCcalls;

    int cachedslot;
};

typedef struct Closure
{
    CommonHeader ; // 0
    uint8_t isC; // 3
    uint8_t preload; // 4
    uint8_t nupvalues; // 5
    uint8_t stacksize; // 6
    GCObject* gclist; // 8
    struct Table* env; // 16

    union
    {
        struct
        {
            closure_c_f<lua_CFunction> f; // 24
            closure_c_debugname<const char*> debugname; // 32
            closure_c_cont<lua_Continuation> cont; // 40
            TValue upvals[1]; // 48
        } c;

        struct
        {
            closure_l_p<struct Proto*> p; // 24
            TValue uprefs[1]; // 44
        } l;
    };
} Closure;

typedef struct global_State {
    int gcgoal;
    int gcstepsize;
    int gcstepmul;
    uint8_t __padding_0[ 4 ];
    lua_Alloc frealloc;
    void* ud;
    size_t GCthreshold;
    size_t totalbytes;
    uint8_t currentwhite;
    uint8_t gcstate;
    uint8_t __padding_1[ 4 ];
    stringtable strt;
    GCObject* gray;
    GCObject* grayagain;
    GCObject* weak;
    UpVal uvhead;
    struct lua_Page* freegcopages[ LUA_SIZECLASSES ];
    struct lua_Page* freepages[ LUA_SIZECLASSES ];
    struct lua_Page* sweepgcopage;
    size_t memcatbytes[ LUA_MEMORY_CATEGORIES ];
    struct lua_State* mainthread;
    struct lua_Page* allpages;
    struct lua_Page* allgcopages;
    struct LuaTable* mt[ LUA_T_COUNT ];
    TString* ttname[ LUA_T_COUNT ];
    TString* tmname[ TM_N ];
    TValue pseudotemp;
    TValue registry;
    int registryfree;
    uint64_t ptrenckey[ 4 ];
    uint64_t rngstate;
    lua_Callbacks cb;
    lua_ExecutionCallbacks ecb;
    char _[ 0x8 ];
    void ( *udatagc[ LUA_UTAG_LIMIT ] )( lua_State*, void* );
    LuaTable* udatamt[ LUA_UTAG_LIMIT ];
    TString* lightuserdataname[ LUA_LUTAG_LIMIT ];
    GCStats gcstats;
} global_State;

typedef struct Proto 
{
    CommonHeader ; // 0
    uint8_t is_vararg; // 3
    uint8_t maxstacksize; // 4
    uint8_t nups; // 5
    uint8_t numparams; // 6
    uint8_t flags; // 7
    TValue* k; // 8
    Instruction* code; // 16
    proto_lineinfo<uint8_t*> lineinfo; // 24
    proto_locvars<struct LocVar*> locvars; // 32
    proto_source<TString*> source; // 40
    proto_userdata<void*> userdata; // 48
    struct Proto** p; // 56
    const Instruction* codeentry; // 64
    proto_upvalues<TString**> upvalues; // 72
    proto_abslineinfo<int*> abslineinfo; // 80
    GCObject* gclist; // 88
    proto_debuginsn<uint8_t*> debuginsn; // 96
    proto_debugname<TString*> debugname; // 104
    proto_typeinfo<uint8_t*> typeinfo; // 112
    void* execdata; // 120
    uintptr_t exectarget; // 128
    int sizek; // 136
    int linegaplog2; // 140
    int sizetypeinfo; // 144
    int sizelineinfo; // 148
    int sizecode; // 152
    int sizelocvars; // 156
    int bytecodeid; // 160
    int sizep; // 164
    int linedefined; // 168
    int sizeupvalues; // 172
} Proto;
